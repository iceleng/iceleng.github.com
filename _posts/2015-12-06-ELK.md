---
layout: post
title:  ELK学习
categories: [elk]
---

#ELK相关资料

##Elk
Elastic中文社区
http://elasticsearch.cn/

##kibana4 教程
https://www.timroes.de/2015/02/07/kibana-4-tutorial-part-3-visualize/

##ogstash自定义插件和资料
http://blog.csdn.net/earbao/article/details/49335217

##Logstash 最佳实践
http://udn.yyuap.com/doc/logstash-best-practice-cn/index.html

##运维生存时间 elk文章
http://www.ttlsa.com/log-system/elk/

##nginx带upstream信息的log配置
	log_format  combine '$remote_addr - $remote_user [$time_local] "$request" $http_host ' 
	'$status $body_bytes_sent "$http_referer" '
	'"$http_user_agent" "$http_x_forwarded_for" '
	'$upstream_addr $upstream_status $upstream_cache_status "$upstream_http_content_type" $upstream_response_time > $request_time';


##logstash nginx配置文件
	input{
	  stdin{}
	  file{
			type=>"nginx-access"
	    path=>"/var/log/nginx/iceleng.access.log"
	    start_position=>"beginning"
	  }
	}
	filter{
		grok{
			#patterns_dir=>"../patterns"
			#match=>{"message"=>"%{NGINXACCESS}"}
	    match =>{"message"=>"%{IPORHOST:client_ip} - - \[%{HTTPDATE:timestamp}\] \"(?:%{WORD:verb} %{NOTSPACE:request}(?: HTTP/%{NUMBER:http_version})?|-)\" %{IPORHOST:domain} %{NUMBER:response} (?:%{NUMBER:bytes}|-) %{QS:referrer} %{QS:agent} (%{QS:x_forword}|-) (%{URIHOST:upstream_host}|-) (%{NUMBER:upstream_response}|-) (%{WORD:upstream_cache_status}|-) %{QS:upstream_content_type} (%{BASE16FLOAT:upstream_response_time}|-) > (%{BASE16FLOAT:request_time}|-)"}
	  }
	  date {
	    match => ["timestamp" , "dd/MMM/YYYY:HH:mm:ss Z"]
	  }
	}
	output{
	  stdout{}
	  elasticsearch{
	    hosts=>"192.168.1.7"
	  }
	}
